name: "ğŸ“¦ Supply Chain SBOM"

on:
  push:
    branches: [ "main", "master" ]
  schedule:
    - cron: '30 3 * * *'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  sbom:
    name: "ğŸ—ï¸ Generate & Submit SBOM"
    runs-on: ubuntu-latest
    permissions:
      contents: write # Needed for dependency graph submission
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

      - name: Generate SBOM (CycloneDX)
        uses: CycloneDX/gh-python-generate-sbom@d63650a32717082390a786016e10098dfc516639 # v2.1.0
        with:
          input: 'requirements.txt'
          output: 'bom.json'

      - name: Upload SBOM Artifact
        uses: actions/upload-artifact@b7c566a772e6b6bfb58ed0dc250532a479d7789f # v6.0.0
        with:
          name: sbom-cyclonedx
          path: bom.json

      - name: Submit Dependency Graph
        uses: actions/dependency-graph-submission@1a21f73752693821f574a2f81a742f9f1b95420f # v0.0.1
        with:
          directory: '.'
