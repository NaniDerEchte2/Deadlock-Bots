name: "ðŸ”’ Update Pip Dependency Hashes"

on:
  push:
    paths:
      - '.github/workflows/requirements-tools.txt'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  update-hashes:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          fetch-depth: 0

      - name: Setup Python
        uses: actions/setup-python@a309ff8b426b58ec0e2a45f0f869d46889d02405 # v6.2.0
        with:
          python-version: '3.12'

      - name: Install uv
        run: |
          pip install uv==0.6.1 \
            --hash=sha256:f9e3a59deb1dfcab1f62ba7585bcd066d780177ea2f7de7f382921d76c580323 \
            --hash=sha256:e50e5209d86255a92bfb453bcd4399f6f47a7cfbb6d1ca6facf83edf97d10805 \
            --hash=sha256:be98d181a1a72b1ee7126c3de926eb8d71f5391fd0482371616b46ddb49366e6 \
            --hash=sha256:e72c31fe02f2e5856d515b12788ff6d7bfd987bfe4e16599682cb2352a7a2cc0 \
            --hash=sha256:005b2dcca113a9f1537583ada24752287b1ddf831f1add9a7099fac259bf269c \
            --hash=sha256:b52f9e35858c30bc866d07c595d007c6ec713e195174ca9ec2b1806c2c9a8f22 \
            --hash=sha256:d6cd4ddf03cce1e963120dbb0b1168ba6c6d4d462019947fdecc64b2596aaae6 \
            --hash=sha256:01fa8449ab1d96951711c3073a7d93ae2ccd333cc2141fc30873e720e9aeea34 \
            --hash=sha256:e550f08e538260b6d9caae9a4e1999de04f03487f11b6fcdc718d1ae2ba1a5e9 \
            --hash=sha256:62ef67f173ced2e1beb5e578db08e0e057ee5f21e0d74f09b27f7b43b143fe2a \
            --hash=sha256:c13bb592a1b0f1bcbaf3235f634e7a35bd9840ca497020792fbcc96185174fb4 \
            --hash=sha256:183ee2ec50197e584d24421966acf083cf5e9048489eebcb9ee7532d4ecf65d1 \
            --hash=sha256:636c4570e5e39522ba2b8531fbcb5cddcc3fd74c8e733039b9a3ca29693f6e26 \
            --hash=sha256:d8f21240fbcff0d27a38ee04348a62ee2e25c3ebd4741b18a6bd3dd6891eec5a \
            --hash=sha256:1876319693e52e15ff72b17cb06a3036cd659d47eeda52e82867017c5a09b6b3 \
            --hash=sha256:e5ba927dcbb90d241acbd8ac6181ef104269875f8e4d4fb69286cb356a173282 \
            --hash=sha256:8bd37eb73cb8b7f6bc862c27b9c79ef3c4f809775f3c62f3e8ba6872bf211c22 \
            --hash=sha256:7b371891dc6fd174bb3bc3889ff42aa4e07e59fb970b47aa980d8b403e3457a9

      - name: Generate hash-locked requirements
        run: |
          uv pip compile \
            .github/workflows/requirements-tools.txt \
            --generate-hashes \
            --no-header \
            --output-file .github/requirements-tools-locked.txt \
            --quiet

      - name: Commit if changed
        run: |
          git add .github/requirements-tools-locked.txt
          if git diff --cached --quiet; then
            echo "No changes to requirements-tools-locked.txt"
            exit 0
          fi
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git commit -m "chore(deps): update hash-locked pip requirements"
          git push
