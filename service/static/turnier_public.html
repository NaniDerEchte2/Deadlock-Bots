<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turnier â€“ EarlySalty</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080c14;
  --surface: #0f1320;
  --surface2: #161b2e;
  --surface3: #1d2340;
  --border: #222843;
  --border2: #2c3358;
  --accent: #6c63ff;
  --accent-dim: rgba(108,99,255,.12);
  --accent-glow: rgba(108,99,255,.28);
  --green: #3dd68c;
  --green-dim: rgba(61,214,140,.1);
  --gold: #f5c542;
  --gold-dim: rgba(245,197,66,.1);
  --text: #e4e7f0;
  --text2: #9ba3bf;
  --muted: #5c6380;
  --danger: #e05252;
  --danger-dim: rgba(224,82,82,.1);
  --r: 12px;
  --r-sm: 8px;
  --r-xs: 6px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  min-height: 100vh;
}
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse 70% 45% at 15% 5%, rgba(108,99,255,.055) 0%, transparent 55%),
    radial-gradient(ellipse 55% 40% at 85% 95%, rgba(61,214,140,.035) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

/* â”€â”€ Nav â”€â”€ */
.nav {
  position: sticky;
  top: 0;
  z-index: 200;
  height: 58px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 28px;
  background: rgba(8,12,20,.82);
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
  border-bottom: 1px solid var(--border);
}
.nav-brand {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 16px;
  font-weight: 700;
  color: var(--text);
  text-decoration: none;
  letter-spacing: -.2px;
}
.nav-brand-logo {
  width: 30px;
  height: 30px;
  border-radius: 8px;
  background: linear-gradient(135deg, var(--accent), #a78bfa);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  flex-shrink: 0;
}
.nav-right { display: flex; align-items: center; gap: 10px; }
.nav-user { font-size: 12px; color: var(--text2); }

/* â”€â”€ Layout â”€â”€ */
.main {
  position: relative;
  z-index: 1;
  max-width: 1260px;
  margin: 0 auto;
  padding: 28px 24px 72px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* â”€â”€ Toast â”€â”€ */
.toast {
  position: fixed;
  top: 68px;
  left: 50%;
  transform: translateX(-50%) translateY(-4px);
  z-index: 600;
  padding: 11px 20px;
  border-radius: var(--r-sm);
  font-size: 13px;
  font-weight: 500;
  max-width: 440px;
  width: calc(100% - 40px);
  text-align: center;
  pointer-events: none;
  opacity: 0;
  transition: opacity .2s, transform .2s;
  box-shadow: 0 8px 28px rgba(0,0,0,.45);
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.toast.error  { background: #221416; border: 1px solid rgba(224,82,82,.35); color: #ff9090; }
.toast.success{ background: #0d201a; border: 1px solid rgba(61,214,140,.3); color: var(--green); }
.toast.info   { background: #111628; border: 1px solid rgba(108,99,255,.3); color: #a78bfa; }
.hidden { display: none !important; }

/* â”€â”€ Buttons â”€â”€ */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 18px;
  border-radius: var(--r-sm);
  border: none;
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
  font-family: inherit;
  text-decoration: none;
  white-space: nowrap;
  transition: transform .12s, box-shadow .15s, background .15s, opacity .15s;
}
.btn:hover { transform: translateY(-1px); }
.btn:active { transform: translateY(0); }
.btn:disabled { opacity: .38; cursor: not-allowed; transform: none; }

.btn-primary { background: var(--accent); color: #fff; }
.btn-primary:hover { background: #7c74ff; box-shadow: 0 4px 16px var(--accent-glow); }
.btn-success { background: linear-gradient(135deg, #27a060, var(--green)); color: #0a1a0f; font-weight: 700; }
.btn-success:hover { box-shadow: 0 4px 16px rgba(61,214,140,.28); }
.btn-danger  { background: var(--danger); color: #fff; }
.btn-danger:hover { background: #c94545; }
.btn-ghost {
  background: transparent;
  color: var(--text2);
  border: 1px solid var(--border2);
}
.btn-ghost:hover { background: var(--surface2); color: var(--text); border-color: #3a4265; }
.btn-sm  { padding: 5px 12px; font-size: 12px; border-radius: var(--r-xs); }
.btn-xs  { padding: 3px 8px; font-size: 11px; border-radius: 5px; }

/* â”€â”€ Badges â”€â”€ */
.badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px 9px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: .1px;
}
.badge-green  { background: var(--green-dim); color: var(--green); border: 1px solid rgba(61,214,140,.25); }
.badge-red    { background: var(--danger-dim); color: #ff9090; border: 1px solid rgba(224,82,82,.25); }
.badge-gold   { background: var(--gold-dim); color: var(--gold); border: 1px solid rgba(245,197,66,.25); }
.badge-blue   { background: var(--accent-dim); color: #a78bfa; border: 1px solid rgba(108,99,255,.25); }
.badge-muted  { background: var(--surface2); color: var(--muted); border: 1px solid var(--border); }

/* â”€â”€ Cards â”€â”€ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 22px;
  position: relative;
  overflow: hidden;
}
.card-hd {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 18px;
  gap: 12px;
}
.card-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .7px;
  color: var(--text2);
  display: flex;
  align-items: center;
  gap: 7px;
}

/* â”€â”€ Period Hero â”€â”€ */
.period-hero {
  border-radius: var(--r);
  padding: 26px 28px 22px;
  position: relative;
  overflow: hidden;
  background: var(--surface);
  border: 1px solid var(--border);
}
.period-hero::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  border-radius: var(--r) var(--r) 0 0;
  opacity: 0;
  transition: opacity .3s;
}
.period-hero.open   { border-color: rgba(61,214,140,.18); }
.period-hero.open::before   { opacity: 1; background: linear-gradient(90deg, transparent 0%, var(--green) 40%, #a8f0cb 60%, transparent 100%); }
.period-hero.pending{ border-color: rgba(245,197,66,.18); }
.period-hero.pending::before{ opacity: 1; background: linear-gradient(90deg, transparent 0%, var(--gold) 40%, #fde68a 60%, transparent 100%); }
.period-hero.closed { border-color: rgba(224,82,82,.18); }
.period-hero.closed::before { opacity: .7; background: linear-gradient(90deg, transparent 0%, var(--danger) 40%, #ffa0a0 60%, transparent 100%); }

.period-hero-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 16px;
  flex-wrap: wrap;
}
.period-name { font-size: 21px; font-weight: 800; color: var(--text); line-height: 1.2; margin-top: 8px; letter-spacing: -.3px; }
.period-pill {
  display: inline-flex;
  align-items: center;
  gap: 7px;
  padding: 5px 13px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 700;
  flex-shrink: 0;
}
.period-pill.open    { background: var(--green-dim); color: var(--green); border: 1px solid rgba(61,214,140,.3); }
.period-pill.pending { background: var(--gold-dim);  color: var(--gold);  border: 1px solid rgba(245,197,66,.3); }
.period-pill.closed  { background: var(--danger-dim);color: #ff9090;       border: 1px solid rgba(224,82,82,.3); }
.period-pill.none    { background: var(--surface2); color: var(--muted); border: 1px solid var(--border); }

.status-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
.open    .status-dot { background: var(--green); animation: pulse-dot 2s ease infinite; }
.pending .status-dot { background: var(--gold); }
.closed  .status-dot { background: #ff9090; }
.none    .status-dot { background: var(--muted); }
@keyframes pulse-dot {
  0%,100%{ opacity:1; transform:scale(1); }
  50%    { opacity:.5; transform:scale(1.4); }
}

.period-meta {
  display: flex;
  gap: 18px;
  flex-wrap: wrap;
  color: var(--text2);
  font-size: 12px;
  margin-top: 12px;
}
.period-meta-item { display: flex; align-items: center; gap: 5px; }
.period-actions   { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 18px; }

/* â”€â”€ My Status â”€â”€ */
.stat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
  gap: 10px;
  margin-bottom: 16px;
}
.stat-box {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  padding: 12px 14px;
}
.stat-lbl { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: .6px; color: var(--muted); margin-bottom: 5px; }
.stat-val { font-size: 15px; font-weight: 700; color: var(--text); }

/* â”€â”€ Teams â”€â”€ */
.teams-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(255px, 1fr));
  gap: 14px;
}
.team-card {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  overflow: hidden;
  transition: border-color .2s, box-shadow .2s;
}
.team-card:hover { border-color: var(--border2); box-shadow: 0 6px 24px rgba(0,0,0,.28); }
.team-card-top  { padding: 14px 14px 12px; }
.team-card-hd   { display: flex; align-items: flex-start; justify-content: space-between; gap: 8px; margin-bottom: 10px; }
.team-card-name { font-size: 14px; font-weight: 700; color: var(--text); word-break: break-word; }
.team-cap {
  font-size: 11px;
  font-weight: 600;
  color: var(--muted);
  white-space: nowrap;
  background: var(--surface3);
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid var(--border);
}
.team-cap.full { color: var(--green); border-color: rgba(61,214,140,.3); background: var(--green-dim); }
.team-bar { height: 3px; background: var(--border); border-radius: 999px; margin-bottom: 12px; overflow: hidden; }
.team-bar-fill { height: 100%; border-radius: 999px; transition: width .5s ease; background: linear-gradient(90deg, var(--accent), #a78bfa); }
.team-bar-fill.full { background: linear-gradient(90deg, #27a060, var(--green)); }

.member-list { list-style: none; }
.member-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 5px 0;
  border-bottom: 1px solid rgba(255,255,255,.04);
}
.member-row:last-child { border-bottom: none; }
.member-av {
  width: 24px;
  height: 24px;
  border-radius: 6px;
  background: var(--surface3);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  color: var(--accent);
  text-transform: uppercase;
  flex-shrink: 0;
}
.member-name { flex: 1; font-size: 12px; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.member-rank { font-size: 10px; font-weight: 600; color: var(--muted); white-space: nowrap; background: var(--surface3); padding: 1px 6px; border-radius: 4px; }
.team-foot {
  padding: 9px 14px;
  border-top: 1px solid rgba(255,255,255,.04);
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}
.rename-form { padding: 10px 14px; border-top: 1px solid rgba(255,255,255,.04); background: var(--surface); }
.rename-input {
  width: 100%;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r-xs);
  color: var(--text);
  padding: 7px 10px;
  font-size: 13px;
  font-family: inherit;
  outline: none;
  transition: border-color .15s;
  margin-bottom: 8px;
}
.rename-input:focus { border-color: var(--accent); }

/* â”€â”€ Solo section â”€â”€ */
.solo-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  background: none;
  border: none;
  cursor: pointer;
  font-family: inherit;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .7px;
  color: var(--text2);
  padding: 0;
}
.toggle-chevron { font-size: 9px; color: var(--muted); transition: transform .2s; }
.solo-toggle.open .toggle-chevron { transform: rotate(90deg); }
.solo-body { margin-top: 16px; }
.solo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(195px, 1fr));
  gap: 8px;
}
.solo-chip {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  padding: 7px 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: border-color .15s;
}
.solo-chip:hover { border-color: var(--border2); }
.solo-av {
  width: 24px;
  height: 24px;
  border-radius: 6px;
  background: var(--surface3);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  color: var(--muted);
  text-transform: uppercase;
  flex-shrink: 0;
}
.solo-name { flex: 1; font-size: 12px; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.solo-rank { font-size: 10px; color: var(--muted); white-space: nowrap; }

/* â”€â”€ Bracket â”€â”€ */
.bracket-wrap { overflow-x: auto; padding-bottom: 4px; }
.bracket { display: flex; min-width: max-content; }
.b-round { display: flex; flex-direction: column; justify-content: space-around; min-width: 186px; }
.b-round-lbl { text-align: center; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: .7px; color: var(--muted); margin-bottom: 14px; }
.b-match { display: flex; flex-direction: column; gap: 2px; margin: 6px 10px; flex: 1; justify-content: center; }
.b-entry {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 8px 11px;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: border-color .15s;
}
.b-entry:hover { border-color: var(--border2); }
.b-entry.tbd { opacity: .35; font-style: italic; }
.b-entry.bye { opacity: .3; font-style: italic; }
.b-entry.winner { border-color: rgba(245,197,66,.4); background: rgba(245,197,66,.05); }
.b-divider { height: 1px; background: var(--border); margin: 2px 10px; }
.b-score { font-size: 10px; font-weight: 600; color: var(--muted); }

/* â”€â”€ Modal â”€â”€ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.72);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  z-index: 400;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  animation: fadein .15s ease;
}
.modal-overlay.hidden { display: none; }
@keyframes fadein { from { opacity:0 } to { opacity:1 } }
.modal {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--r);
  padding: 26px;
  width: 100%;
  max-width: 430px;
  animation: scalein .18s ease;
  box-shadow: 0 28px 64px rgba(0,0,0,.55);
}
@keyframes scalein { from { opacity:0; transform:scale(.95) } to { opacity:1; transform:scale(1) } }
.modal-title { font-size: 17px; font-weight: 700; margin-bottom: 4px; }
.modal-sub   { font-size: 13px; color: var(--text2); margin-bottom: 18px; line-height: 1.5; }
.modal-foot  { display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px; }
.modal-err   {
  background: var(--danger-dim);
  border: 1px solid rgba(224,82,82,.3);
  color: #ff9090;
  border-radius: var(--r-xs);
  padding: 8px 12px;
  font-size: 12px;
  margin-bottom: 14px;
}
.field-lbl {
  display: block;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .5px;
  color: var(--muted);
  margin-bottom: 6px;
}
.field-inp {
  width: 100%;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  color: var(--text);
  padding: 10px 13px;
  font-size: 14px;
  font-family: inherit;
  outline: none;
  transition: border-color .15s;
}
.field-inp:focus { border-color: var(--accent); }

/* Mode cards */
.mode-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 4px; }
.mode-card {
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  padding: 16px 12px 14px;
  cursor: pointer;
  transition: all .15s;
  background: var(--surface2);
  text-align: center;
  user-select: none;
}
.mode-card:hover { border-color: var(--border2); background: var(--surface3); }
.mode-card.selected { border-color: var(--accent); background: var(--accent-dim); box-shadow: 0 0 0 1px var(--accent); }
.mode-icon { font-size: 22px; margin-bottom: 6px; }
.mode-lbl  { font-size: 13px; font-weight: 700; }
.mode-desc { font-size: 11px; color: var(--muted); margin-top: 3px; }

/* Team option list */
.team-option-list { display: flex; flex-direction: column; gap: 6px; max-height: 260px; overflow-y: auto; padding-right: 2px; margin-bottom: 6px; }
.team-option {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 13px;
  border: 1px solid var(--border);
  border-radius: var(--r-sm);
  cursor: pointer;
  transition: all .15s;
  background: var(--surface2);
  user-select: none;
}
.team-option:hover { border-color: var(--border2); background: var(--surface3); }
.team-option.selected { border-color: var(--accent); background: var(--accent-dim); }
.t-opt-name { font-size: 13px; font-weight: 600; }
.t-opt-cnt  { font-size: 11px; color: var(--muted); background: var(--surface3); padding: 2px 7px; border-radius: 999px; border: 1px solid var(--border); }
.new-team-sep { display: flex; align-items: center; gap: 10px; margin: 12px 0 10px; color: var(--muted); font-size: 11px; }
.new-team-sep::before, .new-team-sep::after { content:''; flex:1; height:1px; background:var(--border); }

/* Loading / empty */
.spinner { display: inline-block; width: 17px; height: 17px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin .7s linear infinite; flex-shrink: 0; }
@keyframes spin { to { transform:rotate(360deg) } }
.loading-wrap { display: flex; align-items: center; gap: 10px; color: var(--muted); padding: 22px; }
.empty-hint { color: var(--muted); text-align: center; padding: 28px 16px; font-size: 13px; line-height: 1.7; }

/* â”€â”€ Responsive â”€â”€ */
@media (max-width: 640px) {
  .nav { padding: 0 16px; }
  .main { padding: 16px 14px 56px; }
  .period-hero { padding: 18px 18px 16px; }
  .period-name { font-size: 17px; }
  .mode-grid { grid-template-columns: 1fr; }
  .modal { padding: 18px; }
}
</style>
</head>
<body>

<!-- Nav -->
<nav class="nav">
  <a class="nav-brand" href="/">
    <div class="nav-brand-logo">ğŸ†</div>
    Turnier
  </a>
  <div class="nav-right">
    <span class="nav-user" id="userLabel"></span>
    <a id="authLink" class="btn btn-primary btn-sm" href="/auth/login">Mit Discord anmelden</a>
  </div>
</nav>

<!-- Toast -->
<div id="toast" class="toast"></div>

<main class="main">

  <!-- Period Hero -->
  <div id="periodHero" class="period-hero none">
    <div class="loading-wrap"><span class="spinner"></span> Lade...</div>
  </div>

  <!-- My Status -->
  <div id="myStatusCard" class="card hidden">
    <div class="card-hd">
      <div class="card-label"><span>ğŸ“Š</span> Mein Status</div>
    </div>
    <div id="myStatusContent"></div>
  </div>

  <!-- Teams -->
  <div class="card">
    <div class="card-hd">
      <div class="card-label"><span>ğŸ›¡ï¸</span> Teams</div>
      <span id="teamCountBadge" class="badge badge-muted" style="display:none"></span>
    </div>
    <div id="teamsContainer">
      <div class="loading-wrap"><span class="spinner"></span> Lade Teams...</div>
    </div>
  </div>

  <!-- Solo -->
  <div class="card" id="soloCard">
    <div class="card-hd" style="margin-bottom:0">
      <button class="solo-toggle" id="soloToggle" onclick="toggleSolo()">
        <span>ğŸ‘¤</span> Solo-Teilnehmer
        <span id="soloCountBadge" class="badge badge-muted" style="display:none;font-size:10px"></span>
        <span class="toggle-chevron">â–¶</span>
      </button>
    </div>
    <div id="soloBody" class="solo-body hidden"></div>
  </div>

  <!-- Bracket -->
  <div class="card">
    <div class="card-hd">
      <div class="card-label"><span>âš”ï¸</span> Turnierbaum</div>
    </div>
    <div id="bracketContainer">
      <div class="loading-wrap"><span class="spinner"></span> Lade...</div>
    </div>
  </div>

</main>

<!-- â”€â”€ Modals â”€â”€ -->

<!-- Signup mode -->
<div id="modalSignup" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-title">ğŸ® Anmelden</div>
    <div class="modal-sub">WÃ¤hle deinen Anmeldemodus:</div>
    <div class="mode-grid">
      <div class="mode-card selected" id="modeSolo" onclick="selectMode('solo')">
        <div class="mode-icon">ğŸ§‘</div>
        <div class="mode-lbl">Solo</div>
        <div class="mode-desc">Werde automatisch zugeteilt</div>
      </div>
      <div class="mode-card" id="modeTeam" onclick="selectMode('team')">
        <div class="mode-icon">ğŸ›¡ï¸</div>
        <div class="mode-lbl">Team</div>
        <div class="mode-desc">Tritt einem Team bei oder erstelle eines</div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost btn-sm" onclick="closeModal('modalSignup')">Abbrechen</button>
      <button class="btn btn-success btn-sm" onclick="confirmSignupMode()">Weiter â†’</button>
    </div>
  </div>
</div>

<!-- Team select -->
<div id="modalTeamSel" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-title">ğŸ›¡ï¸ Team wÃ¤hlen</div>
    <div class="modal-sub">Tritt einem offenen Team bei oder erstelle ein neues.</div>
    <div id="teamOptList" class="team-option-list"></div>
    <div id="newTeamSep" class="new-team-sep hidden">oder</div>
    <div id="newTeamBlock" class="hidden">
      <label class="field-lbl">Neuer Teamname</label>
      <input class="field-inp" id="newTeamNameInp" placeholder="z. B. Team Alpha" maxlength="32" style="margin-bottom:0">
    </div>
    <div class="modal-foot" style="margin-top:14px">
      <button class="btn btn-ghost btn-sm" onclick="closeModal('modalTeamSel')">Abbrechen</button>
      <button class="btn btn-ghost btn-sm" id="btnShowNewTeam" onclick="showNewTeamBlock()">+ Neues Team</button>
      <button class="btn btn-success btn-sm hidden" id="btnJoinTeam"   onclick="doJoinTeam()">Beitreten â†’</button>
      <button class="btn btn-primary btn-sm hidden" id="btnCreateTeam" onclick="doCreateAndJoin()">Team erstellen</button>
    </div>
  </div>
</div>

<!-- Confirm -->
<div id="modalConfirm" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-title" id="confirmTitle"></div>
    <div class="modal-sub"  id="confirmSub"></div>
    <div class="modal-foot">
      <button class="btn btn-ghost btn-sm" onclick="closeModal('modalConfirm')">Abbrechen</button>
      <button class="btn btn-danger btn-sm" id="confirmOkBtn">BestÃ¤tigen</button>
    </div>
  </div>
</div>

<!-- Team create (standalone) -->
<div id="modalTeamCreate" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-title">ğŸ›¡ï¸ Team erstellen</div>
    <div class="modal-sub">Gib einen Namen fÃ¼r dein neues Team ein.</div>
    <label class="field-lbl">Teamname</label>
    <input class="field-inp" id="teamCreateInp" placeholder="z. B. Team Alpha" maxlength="32">
    <div class="modal-foot">
      <button class="btn btn-ghost btn-sm" onclick="closeModal('modalTeamCreate')">Abbrechen</button>
      <button class="btn btn-primary btn-sm" onclick="submitTeamCreate()">Erstellen</button>
    </div>
  </div>
</div>

<script>
'use strict';

let _state = { me: null, overview: null };
let _signupMode = 'solo';
let _selectedTeamId = null;
let _soloOpen = false;
let _toastTimer = null;

// â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function el(id) { return document.getElementById(id); }
function esc(s) {
  return String(s ?? '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function capitalize(s) { return s ? s[0].toUpperCase() + s.slice(1) : ''; }
function avatarLetter(name) { return (String(name || '?').trim()[0] || '?').toUpperCase(); }
function fmtDate(s) {
  if (!s) return 'â€”';
  try { return new Date(s).toLocaleString('de-DE',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'}); }
  catch { return s; }
}

function showAlert(msg, type='error') {
  const t = el('toast');
  t.className = `toast ${type}`;
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(_toastTimer);
  _toastTimer = setTimeout(() => t.classList.remove('show'), 5000);
}

async function apiFetch(url, opts={}) {
  const csrf = _state.me?.user?.csrf_token;
  const headers = { 'Content-Type': 'application/json', ...(opts.headers || {}) };
  if (csrf) headers['X-CSRF-Token'] = csrf;
  const r = await fetch(url, { ...opts, headers });
  const data = await r.json().catch(() => ({}));
  return { ok: r.ok, status: r.status, data };
}

// â”€â”€ Modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function openModal(id) { el(id).classList.remove('hidden'); }
function closeModal(id) { el(id).classList.add('hidden'); }
document.querySelectorAll('.modal-overlay').forEach(o =>
  o.addEventListener('click', e => { if (e.target === o) closeModal(o.id); })
);

let _confirmCb = null;
function openConfirm(title, sub, cb) {
  _confirmCb = cb;
  el('confirmTitle').textContent = title;
  el('confirmSub').textContent   = sub;
  el('confirmOkBtn').onclick = async () => { closeModal('modalConfirm'); if (_confirmCb) await _confirmCb(); };
  openModal('modalConfirm');
}

// â”€â”€ Topbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderTopbar() {
  const me = _state.me;
  const link = el('authLink');
  if (me?.logged_in) {
    el('userLabel').textContent = me.user.display_name;
    link.textContent = 'Abmelden';
    link.href = '/auth/logout';
    link.className = 'btn btn-ghost btn-sm';
  } else {
    el('userLabel').textContent = '';
    link.textContent = 'Mit Discord anmelden';
    link.href = '/auth/login';
    link.className = 'btn btn-primary btn-sm';
  }
}

// â”€â”€ Period Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderPeriodHero() {
  const ov = _state.overview;
  const me = _state.me;
  const hero = el('periodHero');
  const period = ov?.active_period;

  if (!period) {
    hero.className = 'period-hero none';
    hero.innerHTML = `
      <div><span class="period-pill none"><span class="status-dot"></span>Kein aktives Turnier</span></div>
      <p style="color:var(--muted);font-size:13px;margin-top:10px">Aktuell gibt es keinen aktiven Anmeldezeitraum. Schau spÃ¤ter wieder vorbei!</p>`;
    return;
  }

  const now = new Date();
  const start = new Date(period.registration_start);
  const end   = new Date(period.registration_end);
  const isOpen = start <= now && now <= end;
  const isPending = now < start;
  const cls = isOpen ? 'open' : (isPending ? 'pending' : 'closed');
  const statusText = isOpen ? 'Registrierung offen' : (isPending ? 'Startet bald' : 'Abgelaufen');

  hero.className = `period-hero ${cls}`;
  hero.innerHTML = `
    <div class="period-hero-top">
      <div>
        <span class="period-pill ${cls}"><span class="status-dot"></span>${statusText}</span>
        <div class="period-name">${esc(period.name)}</div>
      </div>
    </div>
    <div class="period-meta">
      <div class="period-meta-item">ğŸ“… ${fmtDate(period.registration_start)} â€“ ${fmtDate(period.registration_end)}</div>
      <div class="period-meta-item">ğŸ‘¥ TeamgrÃ¶ÃŸe: <strong style="color:var(--text)">${period.team_size || 6}</strong></div>
    </div>
    <div class="period-actions" id="periodActions"></div>`;

  const acts = el('periodActions');
  if (me?.logged_in && isOpen) {
    if (me.signup) {
      acts.innerHTML = `<span class="badge badge-green" style="font-size:12px;padding:6px 14px">âœ… Du bist angemeldet</span>`;
    } else {
      acts.innerHTML = `<button class="btn btn-success" onclick="openSignupFlow()">ğŸ® Jetzt anmelden</button>`;
    }
  } else if (!me?.logged_in && isOpen) {
    acts.innerHTML = `<a class="btn btn-primary" href="/auth/login">Mit Discord anmelden</a>`;
  }
}

// â”€â”€ My Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderMyStatus() {
  const me = _state.me;
  const card = el('myStatusCard');
  if (!me?.logged_in) { card.classList.add('hidden'); return; }
  card.classList.remove('hidden');

  const signup = me.signup;
  const content = el('myStatusContent');
  if (!signup) {
    content.innerHTML = '<p style="color:var(--muted);font-size:13px">Du bist noch nicht fÃ¼r das aktuelle Turnier angemeldet.</p>';
    return;
  }

  const rankLabel = signup.rank_subvalue > 0
    ? `${capitalize(signup.rank || 'Unbekannt')} ${signup.rank_subvalue}`
    : capitalize(signup.rank || 'Unbekannt');
  const mode = signup.registration_mode === 'team' ? 'Team' : 'Solo';
  const team = signup.team_name || 'â€”';

  content.innerHTML = `
    <div class="stat-grid">
      <div class="stat-box"><div class="stat-lbl">Rang</div><div class="stat-val">${esc(rankLabel)}</div></div>
      <div class="stat-box"><div class="stat-lbl">Modus</div><div class="stat-val">${esc(mode)}</div></div>
      <div class="stat-box"><div class="stat-lbl">Team</div><div class="stat-val">${esc(team)}</div></div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn btn-danger btn-sm" onclick="doWithdraw()">Abmelden</button>
      ${!signup.team_id ? `<button class="btn btn-ghost btn-sm" onclick="openTeamCreateFlow()">ğŸ›¡ï¸ Team erstellen</button>` : ''}
    </div>`;
}

// â”€â”€ Teams â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderTeams() {
  const ov = _state.overview;
  const me = _state.me;
  const container = el('teamsContainer');
  const countBadge = el('teamCountBadge');

  if (!ov) { container.innerHTML = '<div class="loading-wrap"><span class="spinner"></span> Lade...</div>'; return; }

  const teams = ov.teams || [];
  const period = ov.active_period;
  const teamSize = period?.team_size || 6;

  if (teams.length) {
    countBadge.textContent = `${teams.length} Teams`;
    countBadge.style.display = '';
  } else {
    countBadge.style.display = 'none';
  }

  if (!teams.length) {
    container.innerHTML = '<div class="empty-hint">Noch keine Teams.<br>Melde dich an und erstelle das erste Team!</div>';
    return;
  }

  const myId = me?.logged_in ? me.user.id : null;
  let html = '<div class="teams-grid">';

  for (const t of teams) {
    const isCreator = myId && t.created_by == myId;
    const members = t.members || [];
    const count = members.length;
    const full = count >= teamSize;
    const pct = Math.min(100, Math.round((count / teamSize) * 100));

    html += `<div class="team-card" data-team-id="${t.id}">
      <div class="team-card-top">
        <div class="team-card-hd">
          <div class="team-card-name">${esc(t.name)}</div>
          <span class="team-cap${full ? ' full' : ''}">${count}/${teamSize}${full ? ' âœ“' : ''}</span>
        </div>
        <div class="team-bar"><div class="team-bar-fill${full ? ' full' : ''}" style="width:${pct}%"></div></div>`;

    if (members.length) {
      html += '<ul class="member-list">';
      for (const m of members) {
        const rankStr = m.rank_subvalue > 0
          ? `${capitalize(m.rank || '')} ${m.rank_subvalue}`
          : capitalize(m.rank || '');
        html += `<li class="member-row">
          <div class="member-av">${esc(avatarLetter(m.display_name))}</div>
          <span class="member-name">${esc(m.display_name)}</span>
          <span class="member-rank">${esc(rankStr)}</span>`;
        if (isCreator && m.user_id != myId) {
          html += `<button class="btn btn-danger btn-xs" onclick="doKick(${t.id},${m.user_id})" title="Entfernen">âœ•</button>`;
        }
        html += '</li>';
      }
      html += '</ul>';
    } else {
      html += '<div style="color:var(--muted);font-size:12px;padding:6px 0;font-style:italic">Keine Mitglieder</div>';
    }

    html += '</div>'; // team-card-top

    if (isCreator) {
      html += `<div class="team-foot">
        <button class="btn btn-ghost btn-xs" onclick="toggleRename(${t.id})">âœï¸ Umbenennen</button>
      </div>
      <div id="renameBox-${t.id}" class="rename-form hidden">
        <label class="field-lbl" style="font-size:10px">Neuer Teamname</label>
        <input class="rename-input" id="renameInput-${t.id}" placeholder="${esc(t.name)}" maxlength="32">
        <div style="display:flex;gap:6px">
          <button class="btn btn-primary btn-xs" onclick="doRename(${t.id})">Speichern</button>
          <button class="btn btn-ghost btn-xs"   onclick="toggleRename(${t.id})">Abbrechen</button>
        </div>
      </div>`;
    }

    html += '</div>'; // team-card
  }
  html += '</div>';
  container.innerHTML = html;
}

function toggleRename(teamId) {
  const box = el(`renameBox-${teamId}`);
  box.classList.toggle('hidden');
  if (!box.classList.contains('hidden')) el(`renameInput-${teamId}`)?.focus();
}

// â”€â”€ Solo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function toggleSolo() {
  _soloOpen = !_soloOpen;
  const toggle = el('soloToggle');
  const body   = el('soloBody');
  toggle.classList.toggle('open', _soloOpen);
  if (_soloOpen) { body.classList.remove('hidden'); renderSoloContent(); }
  else            body.classList.add('hidden');
}

function renderSolo() {
  const solos = _state.overview?.solo_signups || [];
  const badge = el('soloCountBadge');
  if (solos.length) { badge.textContent = solos.length; badge.style.display = ''; }
  else                badge.style.display = 'none';
  if (_soloOpen) renderSoloContent();
}

function renderSoloContent() {
  const ov = _state.overview;
  const body = el('soloBody');
  if (!ov) { body.innerHTML = ''; return; }
  const solos = ov.solo_signups || [];
  if (!solos.length) { body.innerHTML = '<div class="empty-hint">Keine Solo-Teilnehmer.</div>'; return; }

  let html = '<div class="solo-grid">';
  for (const s of solos) {
    const rankStr = s.rank_subvalue > 0
      ? `${capitalize(s.rank || '')} ${s.rank_subvalue}`
      : capitalize(s.rank || '');
    html += `<div class="solo-chip">
      <div class="solo-av">${esc(avatarLetter(s.display_name))}</div>
      <span class="solo-name">${esc(s.display_name)}</span>
      <span class="solo-rank">${esc(rankStr)}</span>
    </div>`;
  }
  html += '</div>';
  body.innerHTML = html;
}

// â”€â”€ Bracket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderBracket() {
  const ov = _state.overview;
  const container = el('bracketContainer');
  if (!ov) { container.innerHTML = '<div class="loading-wrap"><span class="spinner"></span> Lade...</div>'; return; }

  const bracket = ov.bracket;
  if (!bracket || bracket.error || !bracket.rounds?.length) {
    container.innerHTML = `<div class="empty-hint">${esc(bracket?.error || 'Noch keine Bracket-Daten.')}<br><span style="font-size:12px">Der Turnierbaum wird generiert sobald genug Teams vollstÃ¤ndig sind.</span></div>`;
    return;
  }

  let html = `<div style="font-size:12px;color:var(--muted);margin-bottom:14px">${bracket.num_entries} Teams Â· ${bracket.num_rounds} Runden Â· ${bracket.slots} Slots</div>`;
  html += '<div class="bracket-wrap"><div class="bracket">';
  for (const round of bracket.rounds) {
    html += `<div class="b-round"><div class="b-round-lbl">${esc(round.label)}</div>`;
    for (const match of round.matches) {
      html += `<div class="b-match">
        ${renderBracketEntry(match.entry_a, match.is_bye && !match.entry_b)}
        <div class="b-divider"></div>
        ${renderBracketEntry(match.entry_b, match.is_bye && !match.entry_a)}
      </div>`;
    }
    html += '</div>';
  }
  html += '</div></div>';
  container.innerHTML = html;
}

function renderBracketEntry(entry, isBye) {
  if (!entry) return `<div class="b-entry tbd">TBD</div>`;
  const cls = isBye ? 'bye' : '';
  return `<div class="b-entry ${cls}">
    <span>${esc(entry.name)}</span>
    ${entry.score ? `<span class="b-score">Ã˜ ${entry.score}</span>` : ''}
  </div>`;
}

// â”€â”€ Signup flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function selectMode(mode) {
  _signupMode = mode;
  el('modeSolo').classList.toggle('selected', mode === 'solo');
  el('modeTeam').classList.toggle('selected', mode === 'team');
}

async function openSignupFlow() {
  _signupMode = 'solo';
  selectMode('solo');
  openModal('modalSignup');
}

async function confirmSignupMode() {
  closeModal('modalSignup');
  if (_signupMode === 'solo') {
    const { ok, data } = await apiFetch('/api/signup', { method: 'POST', body: JSON.stringify({ mode: 'solo' }) });
    if (ok) { showAlert('Erfolgreich angemeldet!', 'success'); await refresh(); }
    else     showAlert(data.error || 'Fehler bei der Anmeldung.');
  } else {
    openTeamSignupFlow();
  }
}

function openTeamSignupFlow() {
  const teams    = _state.overview?.teams || [];
  const period   = _state.overview?.active_period;
  const teamSize = period?.team_size || 6;
  const nonFull  = teams.filter(t => (t.members?.length || 0) < teamSize);

  _selectedTeamId = null;
  el('btnShowNewTeam').classList.remove('hidden');
  el('btnJoinTeam').classList.add('hidden');
  el('btnCreateTeam').classList.add('hidden');
  el('newTeamBlock').classList.add('hidden');
  el('newTeamSep').classList.add('hidden');
  el('newTeamNameInp').value = '';

  let html = '';
  if (nonFull.length) {
    html = nonFull.map(t => `
      <div class="team-option" data-tid="${t.id}" onclick="selectTeamOpt(${t.id}, this)">
        <span class="t-opt-name">${esc(t.name)}</span>
        <span class="t-opt-cnt">${t.members?.length || 0}/${teamSize}</span>
      </div>`).join('');
  } else {
    html = '<div style="color:var(--muted);font-size:13px;margin-bottom:4px">Keine offenen Teams verfÃ¼gbar.</div>';
    setTimeout(showNewTeamBlock, 10);
  }

  el('teamOptList').innerHTML = html;
  openModal('modalTeamSel');
}

function selectTeamOpt(teamId, elem) {
  _selectedTeamId = teamId;
  document.querySelectorAll('.team-option').forEach(o => o.classList.remove('selected'));
  elem.classList.add('selected');
  el('newTeamBlock').classList.add('hidden');
  el('newTeamSep').classList.add('hidden');
  el('btnShowNewTeam').classList.remove('hidden');
  el('btnJoinTeam').classList.remove('hidden');
  el('btnCreateTeam').classList.add('hidden');
}

function showNewTeamBlock() {
  _selectedTeamId = null;
  document.querySelectorAll('.team-option').forEach(o => o.classList.remove('selected'));
  el('newTeamBlock').classList.remove('hidden');
  el('newTeamSep').classList.remove('hidden');
  el('btnShowNewTeam').classList.add('hidden');
  el('btnJoinTeam').classList.add('hidden');
  el('btnCreateTeam').classList.remove('hidden');
  el('newTeamNameInp').focus();
}

async function doJoinTeam() {
  if (!_selectedTeamId) return;
  const { ok, data } = await apiFetch('/api/signup', {
    method: 'POST',
    body: JSON.stringify({ mode: 'team', team_id: _selectedTeamId }),
  });
  closeModal('modalTeamSel');
  if (ok) { showAlert('Team-Anmeldung erfolgreich!', 'success'); await refresh(); }
  else     showAlert(data.error || 'Fehler.');
}

async function doCreateAndJoin() {
  const name = el('newTeamNameInp').value.trim();
  if (!name) { el('newTeamNameInp').focus(); return; }
  const { ok, data } = await apiFetch('/api/signup', {
    method: 'POST',
    body: JSON.stringify({ mode: 'team', team_name: name }),
  });
  closeModal('modalTeamSel');
  if (ok) { showAlert('Team erstellt und angemeldet!', 'success'); await refresh(); }
  else     showAlert(data.error || 'Fehler.');
}

async function doWithdraw() {
  openConfirm('Abmelden', 'MÃ¶chtest du dich wirklich vom Turnier abmelden?', async () => {
    const { ok, data } = await apiFetch('/api/withdraw', { method: 'POST', body: '{}' });
    if (ok) { showAlert('Erfolgreich abgemeldet.', 'success'); await refresh(); }
    else     showAlert(data.error || 'Fehler.');
  });
}

async function openTeamCreateFlow() {
  el('teamCreateInp').value = '';
  openModal('modalTeamCreate');
}

async function submitTeamCreate() {
  const name = el('teamCreateInp').value.trim();
  if (!name) { el('teamCreateInp').focus(); return; }
  const { ok, data } = await apiFetch('/api/team/create', {
    method: 'POST',
    body: JSON.stringify({ name }),
  });
  closeModal('modalTeamCreate');
  if (ok) { showAlert('Team erstellt!', 'success'); await refresh(); }
  else     showAlert(data.error || 'Fehler.');
}

async function doRename(teamId) {
  const name = el(`renameInput-${teamId}`)?.value?.trim();
  if (!name) return;
  const { ok, data } = await apiFetch('/api/team/rename', {
    method: 'POST',
    body: JSON.stringify({ team_id: teamId, name }),
  });
  if (ok) { showAlert('Team umbenannt.', 'success'); await refresh(); }
  else     showAlert(data.error || 'Fehler.');
}

async function doKick(teamId, userId) {
  openConfirm('Mitglied entfernen', 'Dieses Mitglied aus dem Team entfernen?', async () => {
    const { ok, data } = await apiFetch('/api/team/kick', {
      method: 'POST',
      body: JSON.stringify({ team_id: teamId, user_id: userId }),
    });
    if (ok) { showAlert('Mitglied entfernt.', 'success'); await refresh(); }
    else     showAlert(data.error || 'Fehler.');
  });
}

// â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function loadMe() {
  try { _state.me = await (await fetch('/api/me')).json(); }
  catch { _state.me = { logged_in: false }; }
}

async function loadOverview() {
  try { _state.overview = await (await fetch('/api/overview')).json(); }
  catch { _state.overview = null; }
}

async function refresh() {
  await Promise.all([loadMe(), loadOverview()]);
  renderAll();
}

function renderAll() {
  renderTopbar();
  renderPeriodHero();
  renderMyStatus();
  renderTeams();
  renderSolo();
  renderBracket();
}

(async () => {
  await refresh();
  setInterval(refresh, 30000);
})();
</script>
</body>
</html>
